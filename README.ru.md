[![English](https://img.shields.io/badge/lang-English-blue.svg)](README.md) [![Русский](https://img.shields.io/badge/lang-Русский-red.svg)](README.ru.md)

# flux-auto-deleter

> **✅ ОБНОВЛЕНИЕ СОВМЕСТИМОСТИ**
>
> Приложение было успешно протестировано и полностью функционирует как на **Legacy FluxOS**, так и на новой **ArcaneOS**.
>
> *Примечание для пользователей ArcaneOS:* Из-за значительных изменений в новом веб-интерфейсе некоторые визуальные элементы (например, меню или боковые панели) могут не скрываться автоматически, как это происходит на Legacy-нодах. Тем не менее, основной функционал - определение входа в систему и автоматическое удаление приложений - работает корректно.

Electron-приложение для мониторинга узлов Flux и автоматического удаления определенных запущенных приложений.

![Скриншот Flux Auto-Deleter](assets/screenshot.png)

## Скачивание и Установка

Последняя версия: **v0.9.7**

**[Скачать из GitHub Releases](https://github.com/SfilD/flux-auto-deleter/releases/latest)**

Вы можете выбрать:
*   **Portable (.zip):** Установка не требуется. Просто распакуйте и запустите `FluxAutoDeleter.exe`.
*   **Installer (.exe):** Устанавливает приложение в систему и создает ярлык на рабочем столе.

## Архитектура

Приложение построено на Electron и имеет стандартную архитектуру main/renderer process, усиленную современными практиками безопасности.

1.  **Main Process (`monitor-main.js`)**
    *   Выступает в роли бэкенда приложения.
    *   Читает конфигурацию из `settings.ini`.
    *   Управляет жизненным циклом приложения, окнами и всеми событиями IPC.
    *   Выполняет поиск узлов, сканируя IP-адреса параллельно.
    *   Создает и управляет экземплярами `BrowserView` для каждого найденного узла.
    *   Запускает основной цикл автоматизации для удаления приложений.
    *   Шифрует и хранит чувствительные токены в памяти, используя `safeStorage`.

2.  **Renderer Process (UI)**
    *   **Shell (`shell.html`, `shell-renderer.js`):** Главное окно приложения. Предоставляет навигацию по вкладкам, панель быстрого доступа и просмотр логов. Общается с основным процессом через защищенный `contextBridge` (`window.electronAPI`).
    *   **Preloader (`preloader.html`, `preloader-renderer.js`):** Простое окно, отображаемое во время начального поиска узлов.

3.  **Preload Scripts**
    *   **`monitor-preload.js`:** Внедряется в `BrowserView` каждого узла Flux. Его основная обязанность - опрашивать `localStorage` для обнаружения токена `zelidauth`, когда пользователь входит в систему. Затем он отправляет этот токен в основной процесс для запуска цикла автоматизации. Также внедряет CSS для скрытия лишних элементов интерфейса с веб-страницы узла.
    *   **`shell-preload.js` & `preloader-preload.js`:** Эти скрипты безопасно открывают необходимые каналы IPC (`send`, `on`) для своих процессов рендеринга, используя `contextBridge`, в соответствии с современными стандартами безопасности Electron (`contextIsolation: true`).

## Используемые API Эндпоинты

Приложение взаимодействует со следующими API эндпоинтами узлов Flux:

-   `GET /apps/listrunningapps`
    *   **Цель:** Используется как для проверки работоспособности узла на этапе поиска, так и для получения списка запущенных приложений для цикла автоматизации.
    *   **Авторизация:** Не требуется.

-   `GET /apps/appremove?appname={appName}`
    *   **Цель:** Отправляет команду на удаление определенного приложения с узла.
    *   **Авторизация:** **Требуется.** Этот запрос использует заголовок `zelidauth` с токеном, перехваченным `monitor-preload.js`.

## Устранение неполадок

-   **Проблема: Узлы не находятся при запуске.**
    *   **Решение:**
        1.  Проверьте, что IP-адреса в `settings.ini` верны и доступны с вашего компьютера.
        2.  Проверьте подключение к интернету.
        3.  Убедитесь, что брандмауэр или антивирус не блокируют сетевые запросы приложения.

-   **Проблема: Цикл автоматизации не запускается для конкретного узла.**
    *   **Решение:** Убедитесь, что вы успешно вошли в веб-интерфейс узла Flux на соответствующей вкладке в приложении. Цикл автоматизации начинается только после обнаружения валидного токена `zelidauth`.

-   **Проблема: Приложение вылетает или ведет себя неожиданно.**
    *   **Решение:** Проверьте файл `session.log`, расположенный в корневой директории приложения. Для более детальной диагностики установите `Debug = true` в `settings.ini` и перезапустите приложение для генерации более подробных логов.

-   **Проблема: Нужно сбросить все данные/кэш приложения.**
    *   **Решение:** Запустите скрипт `clean-session.bat` (входит в комплект). Это полностью удалит директорию данных приложения (`%AppData%\flux-session-monitor`), эффективно сбросив его к начальному состоянию.

## Процесс Разработки

Этот раздел описывает уникальную среду разработки и тестирования проекта.

-   **Среда разработки:** Код пишется и редактируется в среде WSL (Windows Subsystem for Linux), дистрибутив **Ubuntu-24.04**.

-   **Среда выполнения и тестирования:** Для фактического запуска и тестирования файлы проекта копируются на виртуальную машину VMware с **Windows 10 Pro**.

-   **Рабочая директория на Windows:** На виртуальной машине Windows проект расположен по пути `C:\Projects\flux-auto-deleter\`.

**Важно:** Все команды запуска (например, `npm start`) должны выполняться **только в среде Windows 10 Pro** на виртуальной машине, а не в WSL.

## Обратная связь и Сообщения об ошибках

Если вы столкнулись с ошибками или у вас есть предложения по новым функциям, пожалуйста, откройте тикет (Issue) в нашем репозитории на GitHub. Это самый эффективный способ связаться с разработчиком.

*   **Сообщить об ошибке / Предложить функцию:** [GitHub Issues](https://github.com/SfilD/flux-auto-deleter/issues)

## Поддержка и Донаты

Данное ПО распространяется бесплатно под лицензией Apache 2.0. Если оно оказалось полезным для вас, и вы хотите поддержать его разработку, добровольные пожертвования всячески приветствуются.

**Крипто-адреса:**

*   **FLUX:** `t1RFqDyjAqH1gVgdowqfwRbmMxqgdiwD9dH`
*   **BTC:** `bc1q2r73psn8zznzazx97h9cl4xj2mlywxmpsgydrx`
*   **ETH / USDT (ERC20):** `0x75b3e6773cd61d35532bc82d70aa90aded2b0cb2`
*   **TRON / USDT (TRC20):** `TLhZaC6dCkni74FZKtcDCe12zLUdpJFTk6`
*   **TON / USDT (TON):** `UQB5XehHEvZmhxi6AP1lS1MMOatouQCerJld6IIjmg3wQktB`
